# Развертывание на Render.com

## Исправление ошибки подключения к PostgreSQL

Ошибка, которую вы видели:

```
psycopg2.OperationalError: соединение с сервером на "localhost" (::1), порт 5433 не удался: Отказ в подключении
```

указывает на то, что приложение на Render.com пыталось подключиться к локальной базе данных PostgreSQL, которой там нет.

## Исправления для корректной работы

### 1. Создание базы PostgreSQL на Render.com

1. В панели управления Render создайте базу данных PostgreSQL
   - Выберите "New" → "PostgreSQL"
   - Задайте имя базы данных, например "ittoken-db"
   - Выберите план и регион

### 2. Настройка переменных окружения

На странице вашего веб-сервиса в Render:
1. Перейдите на вкладку "Environment"
2. Убедитесь, что DATABASE_URL настроен правильно и указывает на базу данных Render
   - Значение должно быть внутренним URL базы данных с Render
   - НЕ ДОЛЖНО содержать "localhost" или "127.0.0.1"

### 3. Проверка конфигурации

Файл `render.yaml` сейчас настроен на:
- Использование PostgreSQL из Render
- Автоматическую настройку переменных окружения
- Запуск приложения с правильным WSGI-путем (`gunicorn app.wsgi:app`)

### 4. После развертывания

После успешного развертывания:
1. Войдите в оболочку вашего сервиса (Shell)
2. Запустите отладочный скрипт:
   ```
   python debug_render_db.py
   ```
3. Убедитесь, что база данных доступна
4. При необходимости выполните миграции:
   ```
   python -m app.migrations_update
   ```

## Примечания

- Файл `app/config.py` уже настроен на использование переменных окружения
- При развертывании через Blueprint, база данных и веб-сервис будут настроены автоматически
- Локальная разработка по-прежнему может использовать SQLite или локальный PostgreSQL
