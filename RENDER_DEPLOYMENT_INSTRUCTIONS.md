# Развертывание на Render.com

## Исправление ошибки подключения к PostgreSQL

Ошибка, которую вы видели:

```
psycopg2.OperationalError: соединение с сервером на "localhost" (::1), порт 5433 не удался: Отказ в подключении
```

указывает на то, что приложение на Render.com пыталось подключиться к локальной базе данных PostgreSQL, которой там нет.

## Исправления для корректной работы

### 1. Создание базы PostgreSQL на Render.com

1. В панели управления Render создайте базу данных PostgreSQL
   - Выберите "New" → "PostgreSQL"
   - Задайте имя базы данных, например "ittoken-db"
   - Выберите план и регион

### 2. Настройка переменных окружения

На странице вашего веб-сервиса в Render:
1. Перейдите на вкладку "Environment"
2. Убедитесь, что DATABASE_URL настроен правильно и указывает на базу данных Render
   - Значение должно быть внутренним URL базы данных с Render
   - НЕ ДОЛЖНО содержать "localhost" или "127.0.0.1"

### 3. Проверка конфигурации

Файл `render.yaml` сейчас настроен на:
- Использование PostgreSQL из Render
- Автоматическую настройку переменных окружения
- Запуск prestart.sh скрипта, который автоматически выполняет миграции
- Запуск приложения с правильным WSGI-путем (`gunicorn app.wsgi:app`)

### 4. После развертывания

После успешного развертывания:

1. Миграции базы данных должны выполниться автоматически благодаря скрипту `prestart.sh`, который запускается перед стартом приложения

2. Для проверки состояния базы данных, войдите в оболочку вашего сервиса (Shell) и выполните:
   ```
   python check_database_tables.py
   ```

3. Если по какой-то причине таблицы не были созданы автоматически, выполните миграции вручную:
   ```
   python -m app.migrations_update
   ```
   
   Без создания таблиц вы получите ошибку `relation "block" does not exist`

## Примечания

- Файл `app/config.py` уже настроен на использование переменных окружения
- При развертывании через Blueprint, база данных и веб-сервис будут настроены автоматически
- Локальная разработка по-прежнему может использовать SQLite или локальный PostgreSQL
